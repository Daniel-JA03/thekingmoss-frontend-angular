<div class="container-fluid mt-4 px-4">
  <h3 class="title">Mensajes de Contacto</h3>

  <!-- Filtros -->
  <div class="d-flex mb-3 gap-2">
    <button class="btn btn-outline-primary btn-sm" [class.active]="filtro === 'todos'" (click)="cambiarFiltro('todos')">
      Todos
    </button>
    <button class="btn btn-outline-success btn-sm" [class.active]="filtro === 'leidos'" (click)="cambiarFiltro('leidos')">
      Leídos
    </button>
    <button class="btn btn-outline-warning btn-sm" [class.active]="filtro === 'nopendientes'" (click)="cambiarFiltro('nopendientes')">
      No Leídos
    </button>
  </div>

  <!-- Tabla de mensajes -->
  <div class="table-container-full">
    <table class="table table-striped table-hover custom-table align-middle">
      <thead class="table-dark">
        <tr>
          <th>Estado</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Asunto</th>
          <th>Mensaje</th>
          <th>Fecha</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (msg of mensajesFiltrados; track msg) {
          <tr [class.table-warning]="msg.estado === 'NUEVO'">
            <td>
              <span class="estado-badge" [class.activo]="msg.estado === 'LEIDO'" [class.desactivo]="msg.estado === 'NUEVO'">
                <span class="badge-circle"></span>
                {{ msg.estado === 'LEIDO' ? 'Leído' : 'Nuevo' }}
              </span>
            </td>
            <td>{{ msg.nombre }}</td>
            <td>{{ msg.email }}</td>
            <td>{{ msg.asunto || 'Sin asunto' }}</td>
            <td class="text-truncate clickable" style="max-width: 300px;" (click)="abrirModalMensaje(msg)">
              {{ msg.mensaje }}
            </td>
            <td>{{ msg.fechaCreacion | date:'dd/MM/yyyy HH:mm' }}</td>
            <td class="col-actions">
              <button class="btn btn-sm"
                [class.btn-success]="msg.estado === 'LEIDO'"
                [class.btn-secondary]="msg.estado === 'NUEVO'"
                (click)="marcarComoLeido(msg)"
                [attr.aria-label]="msg.estado === 'LEIDO' ? 'Marcar como no leído' : 'Marcar como leído'">
                <i class="bi"
                  [class.bi-envelope-check]="msg.estado === 'LEIDO'"
                [class.bi-envelope]="msg.estado === 'NUEVO'"></i>
              </button>
              <button class="btn btn-sm btn-info text-white"
                (click)="responderMensaje(msg)"
                aria-label="Responder mensaje">
                <i class="bi bi-reply"></i>
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>

    @if (mensajes.length === 0) {
      <div class="alert alert-info text-center">
        No hay mensajes de contacto registrados.
      </div>
    }
  </div>
</div>

<!-- Modal para ver mensaje completo -->
<div class="modal fade" id="mensajeModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Mensaje Completo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p><strong>De:</strong> {{ mensajeSeleccionado?.nombre }} <{{ mensajeSeleccionado?.email }}></p>
        <p><strong>Asunto:</strong> {{ mensajeSeleccionado?.asunto || 'Sin asunto' }}</p>
        <hr>
          <p>{{ mensajeSeleccionado?.mensaje }}</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-info text-white" (click)="responderMensaje(mensajeSeleccionado!)" data-bs-dismiss="modal">
            <i class="bi bi-reply"></i> Responder
          </button>
        </div>
      </div>
    </div>
  </div>