<!-- Modal para Crear / Editar Producto -->
<div
  class="modal fade"
  id="nuevoProductoModal"
  tabindex="-1"
  aria-hidden="true"
  (hidden.bs.modal)="resetFormulario()"
  >
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          {{ productoSeleccionado ? "Editar Producto" : "Nuevo Producto" }}
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Cerrar"
        ></button>
      </div>

      <div class="modal-body">
        <form [formGroup]="formProducto" (ngSubmit)="guardarProducto()">
          <div class="row g-3">

            <!-- Nombre del Producto -->
            <div class="col-md-6">
              <label for="nombreProducto" class="form-label">Nombre del Producto</label>
              <input
                type="text"
                id="nombreProducto"
                formControlName="nombreProducto"
                class="form-control"
                />
                @if (
                  formProducto.get('nombreProducto')?.invalid &&
                  formProducto.get('nombreProducto')?.touched
                  ) {
                  <div
                    class="text-danger"
                    >
                    <small>
                      {{
                      formProducto.get('nombreProducto')?.errors?.['required']
                      ? 'El nombre es obligatorio.'
                      : formProducto.get('nombreProducto')?.errors?.['minlength']
                      ? 'El nombre debe tener al menos 3 caracteres.'
                      : ''
                      }}
                    </small>
                  </div>
                }
              </div>

              <!-- Stock -->
              <div class="col-md-6">
                <label for="stock" class="form-label">Stock</label>
                <input
                  type="number"
                  id="stock"
                  formControlName="stock"
                  class="form-control"
                  />
                  @if (
                    formProducto.get('stock')?.invalid &&
                    formProducto.get('stock')?.touched
                    ) {
                    <div
                      class="text-danger"
                      >
                      El stock es obligatorio y debe ser >= 0.
                    </div>
                  }
                </div>

                <!-- Precio Unitario -->
                <div class="col-md-6">
                  <label for="precioUnitario" class="form-label">Precio Unitario</label>
                  <input
                    type="number"
                    step="0.01"
                    id="precioUnitario"
                    formControlName="precioUnitario"
                    class="form-control"
                    />
                    @if (
                      formProducto.get('precioUnitario')?.invalid &&
                      formProducto.get('precioUnitario')?.touched
                      ) {
                      <div
                        class="text-danger"
                        >
                        El precio es obligatorio y debe ser >= 0.01.
                      </div>
                    }
                  </div>

                  <!-- Descuento -->
                  <div class="col-md-6">
                    <label for="descuento" class="form-label">Descuento (%)</label>
                    <input
                      type="number"
                      step="0.01"
                      id="descuento"
                      formControlName="descuento"
                      class="form-control"
                      />
                      @if (
                        formProducto.get('descuento')?.invalid &&
                        formProducto.get('descuento')?.touched
                        ) {
                        <div
                          class="text-danger"
                          >
                          El descuento debe estar entre 0 y 100.
                        </div>
                      }
                    </div>

                    <!-- Peso -->
                    <div class="col-md-6">
                      <label for="peso" class="form-label">Peso (kg)</label>
                      <input
                        type="number"
                        step="0.01"
                        id="peso"
                        formControlName="peso"
                        class="form-control"
                        />
                        @if (
                          formProducto.get('peso')?.invalid &&
                          formProducto.get('peso')?.touched
                          ) {
                          <div
                            class="text-danger"
                            >
                            El peso debe ser >= 0.
                          </div>
                        }
                      </div>

                      <!-- Tamaño -->
                      <div class="col-md-6">
                        <label for="tamanio" class="form-label">Tamaño</label>
                        <input
                          type="text"
                          id="tamanio"
                          formControlName="tamanio"
                          class="form-control"
                          />
                        </div>

                        <!-- Descripción -->
                        <div class="col-md-12">
                          <label for="descripcion" class="form-label">Descripción</label>
                          <textarea
                            id="descripcion"
                            formControlName="descripcion"
                            class="form-control"
                            rows="3"
                            placeholder="Descripción del producto..."
                          ></textarea>
                        </div>

                        <!-- Categoría -->
                        <div class="col-md-12">
                          <label for="categoriaId" class="form-label">Categoría</label>
                          <select
                            id="categoriaId"
                            formControlName="categoriaId"
                            class="form-select"
                            >
                            <option value="">Selecciona una categoría</option>
                            @for (cat of categorias; track cat) {
                              <option
                                [value]="cat.categoriaId"
                                >
                                {{ cat.nombreCategoria }}
                              </option>
                            }
                          </select>
                          @if (
                            formProducto.get('categoriaId')?.invalid &&
                            formProducto.get('categoriaId')?.touched
                            ) {
                            <div
                              class="text-danger"
                              >
                              La categoría es obligatoria.
                            </div>
                          }
                        </div>

                        <!-- Subir Imagen -->
                        <div class="col-md-12 mt-3">
                          <label for="imagenProducto" class="form-label">Imagen del Producto</label>
                          <input
                            type="file"
                            id="imagenProducto"
                            class="form-control"
                            (change)="onFileSelected($event)"
                            accept="image/*"
                            />
                            <small class="text-muted">La imagen se subirá al guardar.</small>
                          </div>

                        </div>

                        <!-- Botones -->
                        <div class="mt-4 text-end">
                          <button
                            type="button"
                            class="btn btn-secondary me-2"
                            data-bs-dismiss="modal"
                            >
                            Cancelar
                          </button>
                          <button type="submit" class="btn btn-primary">
                            {{ productoSeleccionado ? "Actualizar" : "Guardar" }}
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>